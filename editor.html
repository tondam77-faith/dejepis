<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Uƒçitelsk√Ω Editor v3.0</title>
    <style>
        :root { --primary: #1a3a5a; --accent: #e67e22; --bg: #f4f7f6; --text: #2c3e50; --danger: #e74c3c; --success: #27ae60; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; }
        header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary); }
        button { cursor: pointer; padding: 8px 15px; border-radius: 6px; border: none; font-weight: bold; }
        .btn-main { background: var(--primary); color: white; }
        .btn-sec { background: white; border: 1px solid #ccc; color: #555; }
        .workspace { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 280px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .deck-list { flex: 1; overflow-y: auto; padding: 10px; }
        .folder-title { font-size: 0.8rem; text-transform: uppercase; color: #999; margin: 15px 0 5px 5px; font-weight: bold; }
        .deck-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .deck-item:hover { background: #f0f5f9; } .deck-item.active { background: var(--primary); color: white; }
        .deck-item .actions { opacity: 0; transition: 0.2s; font-size: 0.8rem; } .deck-item:hover .actions { opacity: 1; }
        .main-area { flex: 1; padding: 20px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
        .dot-green { background: var(--success); } .dot-orange { background: orange; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; }
        .modal-body { background: white; width: 600px; padding: 20px; border-radius: 10px; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>
<header>
    <h1>üéì Editor v3.0</h1>
    <div style="display:flex; gap:10px;">
        <button class="btn-sec" onclick="document.getElementById('file-in').click()">üìÇ Nahr√°t JSON</button>
        <button class="btn-main" onclick="exportData()">üíæ Ulo≈æit JSON</button>
    </div>
    <input type="file" id="file-in" style="display:none" onchange="importData(event)">
</header>
<div class="workspace">
    <div class="sidebar">
        <div class="deck-list" id="deck-list"></div>
        <div style="padding:15px; border-top:1px solid #eee;">
            <button class="btn-main" style="width:100%" onclick="addNewDeck()">‚ûï Nov√© t√©ma</button>
        </div>
    </div>
    <div class="main-area" id="main-area"><div style="text-align:center;color:#999;margin-top:50px;">Vyber t√©ma</div></div>
</div>

<div class="modal" id="modal-overlay">
    <div class="modal-body">
        <h3>Editace karty</h3>
        <input type="text" id="edit-q" placeholder="Ot√°zka">
        <textarea id="edit-a" placeholder="Odpovƒõƒè (ka≈æd√Ω ≈ô√°dek = odr√°≈æka)" rows="3"></textarea>
        <input type="number" id="edit-year" placeholder="Rok (pro ƒçasovou osu)">
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn-sec" onclick="closeModal()">Zru≈°it</button>
            <button class="btn-main" onclick="saveCard()">Ulo≈æit</button>
        </div>
    </div>
</div>

<script>
    let decks = {}, currentDeck = null, editId = null;
    
    // --- STORAGE ---
    const saved = localStorage.getItem("teacher_decks_v3");
    if(saved) { try { decks = JSON.parse(saved); renderSidebar(); } catch(e){} }

    // --- SIDEBAR (SLO≈ΩKY) ---
    function renderSidebar() {
        const list = document.getElementById('deck-list'); list.innerHTML = "";
        
        // Rozdƒõlen√≠ na Aktivn√≠ a Archiv
        const activeDecks = Object.keys(decks).filter(k => !k.startsWith("Archiv:"));
        const archiveDecks = Object.keys(decks).filter(k => k.startsWith("Archiv:"));

        list.innerHTML += `<div class="folder-title">Aktivn√≠ t√©mata</div>`;
        activeDecks.forEach(name => list.appendChild(createDeckItem(name)));
        
        list.innerHTML += `<div class="folder-title" style="margin-top:20px;">Archiv / Rozpracovan√©</div>`;
        archiveDecks.forEach(name => list.appendChild(createDeckItem(name)));
    }

    function createDeckItem(name) {
        const div = document.createElement('div');
        div.className = `deck-item ${currentDeck===name?'active':''}`;
        div.innerHTML = `<span>${name.replace("Archiv:","")}</span> <span class="actions" onclick="event.stopPropagation(); toggleArchive('${name}')">${name.startsWith("Archiv:")?'‚¨ÜÔ∏è':'‚¨áÔ∏è'}</span>`;
        div.onclick = () => { currentDeck=name; renderSidebar(); renderMain(); };
        return div;
    }

    function addNewDeck() { const n = prompt("N√°zev t√©matu:"); if(n && !decks[n]) { decks[n]=[]; save(); renderSidebar(); } }
    function toggleArchive(name) {
        const newName = name.startsWith("Archiv:") ? name.replace("Archiv:","") : "Archiv:"+name;
        decks[newName] = decks[name]; delete decks[name];
        if(currentDeck===name) currentDeck=newName;
        save(); renderSidebar();
    }

    // --- MAIN AREA ---
    function renderMain() {
        if(!currentDeck) return;
        const area = document.getElementById('main-area');
        let html = `<h2>${currentDeck.replace("Archiv:","")} <button class="btn-sec" style="font-size:0.8rem; float:right;" onclick="if(confirm('Smazat?')){delete decks['${currentDeck}']; currentDeck=null; save(); renderSidebar(); area.innerHTML='';}">üóëÔ∏è Smazat t√©ma</button></h2>`;
        html += `<button class="btn-main" onclick="openModal()" style="margin-bottom:15px;">‚ûï P≈ôidat kartu</button>`;
        html += `<table><thead><tr><th>Rok</th><th>Ot√°zka</th><th>Odpovƒõƒè</th><th>Akce</th></tr></thead><tbody>`;
        decks[currentDeck].forEach((c,i) => {
            const dot = c.year ? `<span class="dot dot-green" title="OK pro ƒçasovou osu"></span> ${c.year}` : `<span class="dot dot-orange" title="Chyb√≠ rok"></span> -`;
            html += `<tr><td>${dot}</td><td>${c.q}</td><td>${Array.isArray(c.a)?c.a[0]+'...':c.a}</td><td><button onclick="openModal(${i})">‚úèÔ∏è</button> <button onclick="delCard(${i})">üóëÔ∏è</button></td></tr>`;
        });
        html += `</tbody></table>`;
        area.innerHTML = html;
    }

    // --- EDIT ---
    function openModal(idx=null) {
        editId = idx;
        document.getElementById('modal-overlay').style.display='flex';
        if(idx!==null) {
            const c = decks[currentDeck][idx];
            document.getElementById('edit-q').value = c.q;
            document.getElementById('edit-a').value = Array.isArray(c.a)?c.a.join('\n'):c.a;
            document.getElementById('edit-year').value = c.year || "";
        } else {
            document.getElementById('edit-q').value = ""; document.getElementById('edit-a').value = ""; document.getElementById('edit-year').value = "";
        }
    }
    function closeModal() { document.getElementById('modal-overlay').style.display='none'; }
    function saveCard() {
        const q = document.getElementById('edit-q').value;
        const a = document.getElementById('edit-a').value.split('\n').filter(x=>x.trim());
        const y = document.getElementById('edit-year').value;
        const card = { id: Date.now(), q, a, year: y?parseInt(y):null, reps:0, interval:0, ef:2.5, nextReview:Date.now() };
        
        if(editId!==null) decks[currentDeck][editId] = {...decks[currentDeck][editId], ...card};
        else decks[currentDeck].push(card);
        
        save(); closeModal(); renderMain();
    }
    function delCard(i) { decks[currentDeck].splice(i,1); save(); renderMain(); }

    // --- SYSTEM ---
    function save() { localStorage.setItem("teacher_decks_v3", JSON.stringify(decks)); }
    function exportData() {
        // Exportovat jen NE-Archivovan√©
        const cleanDecks = {};
        Object.keys(decks).filter(k=>!k.startsWith("Archiv:")).forEach(k => cleanDecks[k] = decks[k]);
        const blob = new Blob([JSON.stringify(cleanDecks,null,2)], {type:"application/json"});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="sada_pro_zaky.json"; a.click();
    }
    function importData(e) {
        const r = new FileReader(); r.onload=v=>{ try{decks=JSON.parse(v.target.result); save(); renderSidebar();}catch(e){alert("Chyba");} };
        r.readAsText(e.target.files[0]);
    }
</script>
</body>
</html>